#code to replicate analysis of Lalonde data
rm(list=ls())
library(foreign)
library(Matching)
library(survey)
library(lattice)
# package that implements entropy balancing
library(ebal)
dat <- read.table("cps1re74.csv",header=T)
pwd
getwd()
setwd("~Kellie/Documents/ModelMatch/Data")
dat <- read.table("cps1re74.csv",header=T)
?read.dta
dat <- read.table("cps1re74.dta",header=T)
dat[1:5,]
dat <- read.table("cps1re74.dta")
head(dat)
dat <- read.dta("cps1re74.dta")
head(dat)
dat$u74 <- as.numeric(dat$re74==0)
dat$u75 <- as.numeric(dat$re75==0)
# covars
covars <- c("age","educ","black","hispan","married","nodegree","re74","re75","u74","u75")
# compute all interactions
X <- as.matrix(dat[,covars])
XX <- matrixmaker(X)
covars <- c("age","ed","black","hisp","married","nodeg","re74","re75","u74","u75")
# compute all interactions
X <- as.matrix(dat[,covars])
XX <- matrixmaker(X)
?matrixmaker
out <- c("black.black","nodeg.nodeg","nodeg.ed","married.married","hisp.hisp","hisp.black",
"u75.u75","u74.u74","u74.re74","u75.re75","u74.re74","u75.re75","re74.re74","re75.re75","re75.re74")
XX     <- XX[,(colnames(XX) %in% out)==F]
dat    <- data.frame(dat[,(names(dat) %in% covars)==F],XX)
covars <- names(dat)[-which((names(dat) %in% c("treat","re78")))]
X     <- dat[,covars]
X     <- as.matrix(X)
colnames(X) <-gsub(".age","*Age",colnames(X))
colnames(X) <-gsub(".educ*","*Schooling",colnames(X))
colnames(X) <-gsub(".black","*Black",colnames(X))
colnames(X) <-gsub(".hispan","*Hispanic",colnames(X))
colnames(X) <-gsub(".married","*Married",colnames(X))
colnames(X) <-gsub(".re74","*Earnings 1974",colnames(X))
colnames(X) <-gsub(".re75","*Earnings 1975",colnames(X))
colnames(X) <-gsub(".u74","*Unemployed 1974",colnames(X))
colnames(X) <-gsub(".u75","*Unemployed 1975",colnames(X))
colnames(X) <-gsub(".nodegree","*HS Dropout",colnames(X))
colnames(X) <-gsub("age","Age",colnames(X))
colnames(X) <-gsub("educ","Schooling",colnames(X))
colnames(X) <-gsub("black","Black",colnames(X))
colnames(X) <-gsub("hispan","Hispanic",colnames(X))
colnames(X) <-gsub("married","Married",colnames(X))
colnames(X) <-gsub("re74","Earnings 1974",colnames(X))
colnames(X) <-gsub("re75","Earnings 1975",colnames(X))
colnames(X) <-gsub("u74","Unemployed 1974",colnames(X))
colnames(X) <-gsub("u75","Unemployed 1975",colnames(X))
colnames(X) <-gsub("nodegree","HS Dropout",colnames(X))
dat <- data.frame(dat,X)
Y <- dat$re78
W <- dat$tr
PS  <- glm(W~X,family=binomial(link=logit))$fitted
PSM <- PS
PS  <- PS[W==0]
PS  <- PS/(1-PS)
PSM
head(PS)
hist(PS)
PS  <- glm(W~X,family=binomial(link=logit))$fitted
PS
glm(W~X,family=binomial(link=logit))
dim(X)
head(X)
